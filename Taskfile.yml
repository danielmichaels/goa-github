version: '3'

vars:
  DESIGN: github.com/danielmichaels/goa-github/design
  DATABASE_URL: ./data.db

tasks:
  default:
    cmds:
    - task --list-all
    silent: true

  dev:
    desc: Run server with hot-reloading
    cmds:
    - air

  tidy:
    desc: go mod tidy
    cmds:
    - go mod tidy

  gen:
    desc: goa gen
    cmds:
    - goa gen {{.DESIGN}} {{.CLI_ARGS}}

  example:
    desc: goa example
    cmds:
    - goa example {{.DESIGN}} {{.CLI_ARGS}}

  clean:
    desc: remove autogenerated code
    cmds:
    - rm -rf cmd/backend-cli gen/ goa*

  autoregen:
    desc: run 'goa gen' on file change in design/
    cmds:
    - fd . design | entr task gen

  sqlc:
    desc: Generate models using sqlc
    env:
      CGO_ENABLED: 1
    dir: sql
    cmds:
    - env | ag -i cgo
    - sqlc generate

  golines:
    desc: run golines . -w
    cmds:
    - golines . -w
